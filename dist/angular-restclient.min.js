!function(){function e(){function e(){}function n(e,n,t,i,a,o,r,s,u){this.endpointName=e,this.headResponseHeaderPrefix=a,this.endpointConfig=n,this.pagination=t,this.resource=o(i+this.endpointConfig.route,{},{update:{method:"PUT"},head:{method:"HEAD"}}),this.log=r,this.injector=s,this.q=u}this.endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",this.pagination=!1,e.prototype.route=function(e){return this.route=e,this},e.prototype.model=function(e){return this.model=e,this},e.prototype.container=function(e){return this.container=e,this},n.$inject=["endpoint","endpointConfig","pagination","baseRoute","headResponseHeaderPrefix","$resource","$log","$injector","$q"],n.prototype.get=function(e){var n=this;n.log.debug("apiFactory ("+n.endpointName+"): Endpoint called");var t=n.endpointConfig.container,i=this.injector.get(n.endpointConfig.model);n.log.debug("apiFactory ("+n.endpointName+"): Container set to "+t);var a=this.resource.get(e).$promise;return a.then(function(e){if(angular.isArray(e[t])){n.log.debug("apiFactory ("+n.endpointName+"): Result is an array");var a=[];if(angular.forEach(e[t],function(e){a.push(new i(e))}),n.pagination)var o={count:e.count,offset:e.offset,limit:e.limit,data:a};else var o=a}else{n.log.debug("apiFactory ("+n.endpointName+"): Result is NOT an array");var o=new i(e)}return n.log.debug("apiFactory ("+n.endpointName+"): Mapped result is"),n.log.debug(o),o})},n.prototype.head=function(e){var n=this;n.log.debug("apiFactory ("+n.endpointName+"): (HEAD) Endpoint called");var t=this.q.defer();return this.resource.head(e,function(e,i){var a=i();if(angular.isDefined(n.headResponseHeaderPrefix)&&"*"!==n.headResponseHeaderPrefix)for(var o in a)0==o.toLowerCase().indexOf(n.headResponseHeaderPrefix.toLowerCase())?a[o.substr(n.headResponseHeaderPrefix.length,o.length)]=a[o]:delete a[o];t.resolve(a)}),t.promise},n.prototype.update=function(e,n,t,i){n.__method="update",n._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to update is"),this.log.debug(n),this.resource.update(e,n,function(){t()},function(e){i(e)})},n.prototype.save=function(){var e=arguments[0],n=arguments[1],t=arguments[2],i=arguments[3];angular.isUndefined(arguments[3])&&(n=arguments[0],t=arguments[1],i=arguments[2]),n.__method="save",n._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to save is"),this.log.debug(n),this.resource.save(e,n,function(){t()},function(e){i(e)})},this.baseRoute=function(e){this.baseRoute=e},this.enablePagination=function(e){this.pagination=e},this.headResponseHeaderPrefix=function(e){this.headResponseHeaderPrefix=e},this.endpoint=function(n){var t=new e;return this.endpoints[n]=t,t},this.$get=["$injector",function(e){var t=this,i={};return angular.forEach(t.endpoints,function(a,o){angular.isFunction(a.container)&&(a.container=o),angular.isFunction(t.headResponseHeaderPrefix)&&delete t.headResponseHeaderPrefix,i[o]=e.instantiate(n,{endpoint:o,endpointConfig:a,pagination:t.pagination,baseRoute:t.baseRoute,headResponseHeaderPrefix:t.headResponseHeaderPrefix})}),i}],this.$get.$inject=["$injector"]}function n(e,n,t){function i(){this.__foreignData={},this.__annotation={}}return i.prototype.afterLoad=function(){return!0},i.prototype.beforeSave=function(){return!0},i.prototype.init=function(n){this.__foreignData=n,this.__annotation={},e.debug("Model ("+this.constructor.name+"): Original response object is"),e.debug(this.__foreignData);for(var t in this)if(this.hasOwnProperty(t)&&!(["__foreignData","__annotation"].indexOf(t)>-1)&&(angular.isObject(this[t])&&angular.isDefined(this[t].type)&&(this.__annotation[t]=this[t]),!angular.isUndefined(n)))if(angular.isObject(n)&&n.hasOwnProperty(t)){if(this[t]=n[t],angular.isDefined(this.__annotation[t])&&"relation"==this.__annotation[t].type){var i=this.__annotation[t].relation;if(angular.isUndefined(i.foreignField)&&(i.foreignField=t),angular.isUndefined(this.__foreignData[i.foreignField]))continue;if(null===this.__foreignData[i.foreignField]){this[t]=null;continue}"many"==i.type&&this._mapArray(t,this.__foreignData[i.foreignField],i.model),"one"==i.type&&this._mapProperty(t,this.__foreignData[i.foreignField],i.model)}}else this[t]=null;this.afterLoad(),delete this.__foreignData},i.prototype.callBeforeSave=function(e){angular.isArray(e)&&angular.forEach(e,function(e){e._clean()}),angular.isObject(e)&&!angular.isArray(e)&&e._clean()},i.prototype.__reference="id",i.prototype._clean=function(){this.beforeSave();for(var e in this)if(this.hasOwnProperty(e)){if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].save)){if(!this.__annotation[e].save){delete this[e];continue}if("reference"==this.__annotation[e].save){this._referenceOnly(this[e]);continue}}if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].type)&&"relation"==this.__annotation[e].type&&null!==this[e]){if(!angular.isDefined(this.__annotation[e].relation.type))continue;if("one"==this.__annotation[e].relation.type){this[e]._clean();continue}"many"==this.__annotation[e].relation.type&&angular.forEach(this[e],function(e){e._clean()})}}delete this.__method,delete this.__annotation},i.prototype._mapArray=function(e,t,i){var a=this;if(angular.isUndefined(t)||null==t||0==t.length)return void(a[e]=[]);var o=n.get(i);a[e]=[],angular.forEach(t,function(n){a[e].push(new o(n))})},i.prototype._mapProperty=function(e,t,i){if(angular.isUndefined(t))return void(this[e]=null);var a=n.get(i);this[e]=new a(t)},i.prototype._referenceOnly=function(e){if(angular.isArray(e))angular.forEach(e,function(e){e._referenceOnly(e)});else for(var n in e)e.hasOwnProperty(n)&&n!=e.__reference&&delete e[n]},i.prototype.isValid=function(){for(var e in this)if(this.hasOwnProperty(e)&&angular.isDefined(this.__annotation[e])&&!t[this.__annotation[e].type](this[e]))return!1;return!0},i}function t(){return{string:function(e){return angular.isString(e)},"int":function(e){return angular.isNumber(e)},email:function(e){var n=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return n.test(e)},relation:function(){return!0},"boolean":function(){return!0},date:function(e){return angular.isDate(e)},"float":function(e){return angular.isNumber(e)}}}angular.module("restclient",[]).provider("api",e).factory("Model",n).factory("Validator",t),n.$inject=["$log","$injector","Validator"]}();