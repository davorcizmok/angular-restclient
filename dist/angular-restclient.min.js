!function(){"use strict";function t(t,e){if(!angular.isDefined(t)&&!angular.isDefined(e))return{};if(!angular.isDefined(t))return e;if(!angular.isDefined(e))return t;if(angular.isDefined(angular.merge))return angular.merge(t,e);var n=t.$$hashKey;if(angular.isObject(e)||angular.isFunction(e)){for(var i=Object.keys(e),r=0,o=i.length;o>r;r++){var a=i[r],s=e[a];angular.isObject(s)?(angular.isObject(t[a])||(t[a]=angular.isArray(s)?[]:{}),this(t[a],s)):t[a]=s}return n?t.$$hashKey=n:delete t.$$hashKey,t}}function e(){}function n(){}function i(e,n){var i=this;this.endpointConfig=e,this.resource=n.get("$resource")(this.endpointConfig.baseRoute+this.endpointConfig.route,{},t({get:{method:"GET",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i.mapResult(angular.fromJson(t)),pagination:i.getPagination(t)}}},save:{method:"POST",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i.mapResult(t)}}},update:{method:"PUT",transformResponse:function(t,e,n){return t=angular.fromJson(t),n>=400?t:{result:i.mapResult(t)}}},head:{method:"HEAD"},remove:{method:"DELETE"}},e.actions)),this.log=n.get("$log"),this.injector=n,this.q=n.get("$q")}function r(t,e){this.endpointConfig=t,this.q=e.get("$q"),this.log=e.get("$log"),this.injector=e,this.mock=e.get(t.mock)}function o(t){this.name=t,this.headResponseHeaderPrefix=null}function a(t,e,n){function i(){this.__foreignData={},this.__annotation={}}return i.prototype.afterLoad=function(){return!0},i.prototype.beforeSave=function(){return!0},i.prototype.init=function(e){this.__foreignData=e,this.__annotation={},t.debug("Model ("+this.constructor.name+"): Original response object is:",this.__foreignData);for(var n in this)if(this.hasOwnProperty(n)&&!(["__foreignData","__annotation"].indexOf(n)>-1||(angular.isObject(this[n])&&angular.isDefined(this[n].type)&&(this.__annotation[n]=this[n]),angular.isUndefined(e))))if(angular.isObject(e)&&e.hasOwnProperty(n)){if(this[n]=e[n],angular.isDefined(this.__annotation[n])&&"relation"==this.__annotation[n].type){var i=this.__annotation[n].relation;if(angular.isUndefined(i.foreignField)&&(i.foreignField=n),angular.isUndefined(this.__foreignData[i.foreignField]))continue;if(null===this.__foreignData[i.foreignField]){this[n]=null;continue}"many"==i.type&&this._mapArray(n,this.__foreignData[i.foreignField],i.model),"one"==i.type&&this._mapProperty(n,this.__foreignData[i.foreignField],i.model)}}else this[n]=null;this.afterLoad(),delete this.__foreignData},i.prototype.callBeforeSave=function(t){angular.isArray(t)&&angular.forEach(t,function(t){t._clean()}),angular.isObject(t)&&!angular.isArray(t)&&t._clean()},i.prototype.__reference="id",i.prototype._clean=function(){this.beforeSave();for(var t in this)if(this.hasOwnProperty(t))if(null!==this[t]){if(angular.isDefined(this.__annotation[t])&&angular.isDefined(this.__annotation[t].save)){if(!this.__annotation[t].save){delete this[t];continue}if("reference"==this.__annotation[t].save){this._referenceOnly(this[t]);continue}}if(angular.isDefined(this.__annotation[t])&&angular.isDefined(this.__annotation[t].type)&&"relation"==this.__annotation[t].type&&null!==this[t]){if(!angular.isDefined(this.__annotation[t].relation.type))continue;if("one"==this.__annotation[t].relation.type){this[t]._clean();continue}"many"==this.__annotation[t].relation.type&&angular.forEach(this[t],function(t){t._clean()})}}else delete this[t];delete this.__method,delete this.__annotation},i.prototype._mapArray=function(t,n,i){var r=this;if(angular.isUndefined(n)||null===n||0===n.length)return void(r[t]=[]);if(null===i)return void angular.forEach(n,function(e){r[t].push(e)});var o=e.get(i);r[t]=[],angular.forEach(n,function(e){r[t].push(new o(e))})},i.prototype._mapProperty=function(t,n,i){if(angular.isUndefined(n))return void(this[t]=null);if(null===i)return void(this[t]=n);var r=e.get(i);this[t]=new r(n)},i.prototype._referenceOnly=function(t){if(angular.isArray(t))angular.forEach(t,function(t){t._referenceOnly(t)});else for(var e in t)t.hasOwnProperty(e)&&e!=t.__reference&&delete t[e]},i.prototype.isValid=function(){for(var t in this)if(this.hasOwnProperty(t)&&angular.isDefined(this.__annotation[t])){if(angular.isDefined(this.__annotation[t].required)&&(this.__annotation[t].required&&null===this[t]||this.__annotation[t].required&&""===this[t]))return!1;if(!n[this.__annotation[t].type](this[t])&&this.__annotation[t].required)return!1}return!0},i}function s(){function t(){}return t.prototype.routes=function(t){this.routeMatcher={};for(var e in t)t.hasOwnProperty(e)&&(this.routeMatcher[e.match(/\[(GET|POST|PUT|DELETE|PATCH|HEAD)\]/)[1]+(e.match(/:/g)||[]).length]=t[e])},t.prototype._request=function(t,e,n){if(angular.isDefined(this.routeMatcher[t+e.length])){var i=t+e.length;return angular.isDefined(n)&&e.push({body:n}),this.routeMatcher[i].apply(this,e)}},t}function u(){return{string:function(t){return angular.isString(t)},"int":function(t){return angular.isNumber(t)},email:function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},relation:function(t){return!0},"boolean":function(t){return!0},date:function(t){return angular.isDate(t)},"float":function(t){return angular.isNumber(t)}}}function l(){this.endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",this.baseRoute=function(t){this.baseRoute=t},this.headResponseHeaderPrefix=function(t){this.headResponseHeaderPrefix=t},this.endpoint=function(t){var e=new o(t);return this.endpoints[t]=e,e},this.$get=["$injector",function(t){var e=this,n={};return angular.forEach(e.endpoints,function(o){angular.isFunction(o.container)&&(o.container=o.name),angular.isFunction(e.headResponseHeaderPrefix)&&delete e.headResponseHeaderPrefix,angular.isFunction(o.baseRoute)&&(o.baseRoute=e.baseRoute),o.headResponseHeaderPrefix=e.headResponseHeaderPrefix,angular.isFunction(o.mock)?n[o.name]=new i(o,t):n[o.name]=new r(o,t)}),n}],this.$get.$inject=["$injector"]}angular.module("restclient",["ngResource"]),e.prototype.get=function(){throw"Not Implemented"},e.prototype.post=function(){throw"Not Implemented"},e.prototype["delete"]=function(){throw"Not Implemented"},e.prototype.put=function(){throw"Not Implemented"},e.prototype.head=function(){throw"Not Implemented"},angular.extend(n.prototype,e.prototype),n.prototype.mapResult=function(t){var e,n=this;n.log.debug("apiFactory ("+n.endpointConfig.name+"): Endpoint called");var i=n.endpointConfig.container,r=this.injector.get(n.endpointConfig.model);if(n.log.debug("apiFactory ("+n.endpointConfig.name+"): Container set to "+i),angular.isArray(t)||angular.isArray(t[i])){n.log.debug("apiFactory ("+n.endpointConfig.name+"): Result is an array");var o=angular.isArray(t)?t:t[i],a=[];angular.forEach(o,function(t){a.push(new r(t))}),e=a}else n.log.debug("apiFactory ("+n.endpointConfig.name+"): Result is NOT an array"),e=new r(t);return n.log.debug("apiFactory ("+n.endpointConfig.name+"): Mapped result is:",e),e},n.prototype.getPagination=function(t){if(angular.isDefined(t.count)&&angular.isDefined(t.limit)&&angular.isDefined(t.skip)&&t.limit>0){t.pagesArray=[];var e=t.count/t.limit;e%1!==0&&(e=Math.ceil(e));var n=parseInt(t.skip/t.limit+1),i=t.limit;t.skip+1+t.limit>t.count&&(i=1==n?t.limit:t.count-(n-1)*t.limit);var r;if(5>=n)for(r=1;11>=r;r++)t.pagesArray.push(r);else if(n>=e-5)for(r=e-11;e>=r;r++)t.pagesArray.push(r);else for(r=n-5;n+5>=r;r++)t.pagesArray.push(r);return{count:t.count,limit:t.limit,skip:t.skip,pagesArray:t.pagesArray,pagesCount:e,currentPage:n,currentPageItemsCount:i}}return null},n.prototype.update=function(){return this.put.apply(this,arguments)},n.prototype.save=function(){return this.post.apply(this,arguments)},n.prototype.remove=function(){return this["delete"].apply(this,arguments)},angular.extend(i.prototype,n.prototype),i.prototype.get=function(e){var n=this,i=n.q.defer();return this.resource.get(e,function(r){r.result.pagination=r.pagination,r.result.endpoint=n,r.result.next=function(){return this.endpoint.get(t(e,{_skip:this.pagination.skip+this.pagination.limit,_limit:this.pagination.limit}))},r.result.previous=function(){return this.endpoint.get(t(e,{_skip:this.pagination.skip-this.pagination.limit,_limit:this.pagination.limit}))},r.result.page=function(n){return this.endpoint.get(t(e,{_skip:n*this.pagination.limit-this.pagination.limit,_limit:this.pagination.limit}))},i.resolve(r.result)},function(t){i.reject(t)}),i.promise},i.prototype.head=function(t){var e=this;e.log.debug("apiFactory ("+e.endpointConfig.name+"): (HEAD) Endpoint called");var n=this.q.defer();return this.resource.head(t,function(t,i){var r=i();if(angular.isDefined(e.endpointConfig.headResponseHeaderPrefix)&&"*"!==e.endpointConfig.headResponseHeaderPrefix)for(var o in r)0===o.toLowerCase().indexOf(e.endpointConfig.headResponseHeaderPrefix.toLowerCase())?r[o.substr(e.endpointConfig.headResponseHeaderPrefix.length,o.length)]=r[o]:delete r[o];n.resolve(r)},function(t){n.reject(t)}),n.promise},i.prototype.put=function(t,e){if(angular.isArray(e)){var n=angular.copy(e);e=[],angular.forEach(n,function(t){t.__method="update",t._clean(),e.push(t)})}else e.__method="update",e._clean();this.log.debug("apiFactory ("+this.endpointConfig.name+"): Model to update is:",e);var i=this.q.defer();return this.resource.update(t,e,function(t){i.resolve(t.result)},function(t){i.reject(t)}),i.promise},i.prototype.post=function(){var t,e;angular.isUndefined(arguments[1])?t=arguments[0]:(e=arguments[0],t=arguments[1]);var n=this.q.defer();return t.__method="save",t._clean(),this.log.debug("apiFactory ("+this.endpointConfig.name+"): Model to save is:",t),this.resource.save(e,t,function(t){n.resolve(t.result)},function(t){n.reject(t)}),n.promise},i.prototype["delete"]=function(){var e,n;angular.isUndefined(arguments[1])?e=arguments[0]:(n=arguments[0],e=arguments[1]);var i=this.q.defer();e.__method="remove";var r={id:e[e.__reference]};return this.log.debug("apiFactory ("+this.endpointConfig.name+"): Model to remove is:",e),this.resource["delete"](t(r,n),function(){i.resolve()},function(t){i.reject(t)}),i.promise},angular.extend(r.prototype,n.prototype),r.prototype.extractParams=function(t){for(var e=[],n=/:(\w+)/g,i=n.exec(this.endpointConfig.route);null!=i;)e.push(i[1]),i=n.exec(this.endpointConfig.route);var r=[];return angular.forEach(e,function(e){angular.isObject(t)&&angular.isDefined(t[e])&&r.push(t[e])}),r},r.prototype.get=function(t){var e=this.q.defer(),n=new this.mock,i=n._request("GET",this.extractParams(t)),r=this.mapResult(i);return e.resolve(r),e.promise},r.prototype.post=function(){var t,e,n=new this.mock,i=this.q.defer();angular.isUndefined(arguments[1])?t=arguments[0]:(e=arguments[0],t=arguments[1]),t.__method="save",t._clean();var r=n._request("POST",this.extractParams(e),t),o=this.mapResult(r);return i.resolve(o),i.promise},r.prototype.put=function(t,e){var n=new this.mock,i=this.q.defer();if(angular.isArray(e)){var r=angular.copy(e);e=[],angular.forEach(r,function(t){t.__method="update",t._clean(),e.push(t)})}else e.__method="update",e._clean();var o=n._request("PUT",this.extractParams(t),e),a=this.mapResult(o);return i.resolve(a),i.promise},o.prototype.route=function(t){return this.route=t,this},o.prototype.model=function(t){return this.model=t,this},o.prototype.container=function(t){return this.container=t,this},o.prototype.actions=function(t){return this.actions=t,this},o.prototype.baseRoute=function(t){return this.baseRoute=t,this},o.prototype.mock=function(t){return this.mock=t,this},angular.module("restclient").factory("Model",a),a.$inject=["$log","$injector","Validator"],angular.module("restclient").factory("Mock",s),angular.module("restclient").factory("Validator",u),angular.module("restclient").provider("api",l)}();