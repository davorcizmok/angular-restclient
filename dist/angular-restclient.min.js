!function(){"use strict";function e(e,t){if(!angular.isDefined(e)&&!angular.isDefined(t))return{};if(!angular.isDefined(e))return t;if(!angular.isDefined(t))return e;if(angular.isDefined(angular.merge))return angular.merge(e,t);var n=e.$$hashKey;if(angular.isObject(t)||angular.isFunction(t)){for(var i=Object.keys(t),r=0,o=i.length;o>r;r++){var a=i[r],s=t[a];angular.isObject(s)?(angular.isObject(e[a])||(e[a]=angular.isArray(s)?[]:{}),this(e[a],s)):e[a]=s}return n?e.$$hashKey=n:delete e.$$hashKey,e}}function t(){}function n(){}function i(t,n){var i=this;this._endpointConfig=t,this._resource=n.get("$resource")(this._endpointConfig.baseRoute+this._endpointConfig.route,{},e({get:{method:"GET",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:i._mapResult(angular.fromJson(e)),pagination:i._getPagination(e)}}},save:{method:"POST",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:i._mapResult(e)}}},update:{method:"PUT",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:i._mapResult(e)}}},head:{method:"HEAD"},remove:{method:"DELETE"}},t.actions)),this._log=n.get("$log"),this._injector=n,this._q=n.get("$q")}function r(e,t){this._endpointConfig=e,this._q=t.get("$q"),this._log=t.get("$log"),this._injector=t,this.mock=t.get(e.mock)}function o(e){this.name=e,this.headResponseHeaderPrefix=null}function a(e,t,n){function i(){this._annotation={}}return i.prototype.reference="id",i.prototype.METHOD_SAVE="save",i.prototype.METHOD_UPDATE="update",i.prototype.clean=function(e,t){var n=this;angular.isDefined(e)||(e=n.METHOD_SAVE,null!==n[n.reference]&&(e=n.METHOD_UPDATE)),angular.isDefined(t)||(t=!1),n._beforeSave(e,t);for(var i in n)if(n.hasOwnProperty(i))if(null!==n[i]){if(angular.isDefined(n._annotation[i])&&angular.isDefined(n._annotation[i].type)&&"relation"==n._annotation[i].type&&null!==n[i]){if(!angular.isDefined(n._annotation[i].relation.type))continue;if("one"==n._annotation[i].relation.type){n[i].clean(e,!0);continue}if("many"==n._annotation[i].relation.type){angular.forEach(n[i],function(t){t.clean(e,!0)});continue}}if(angular.isDefined(n._annotation[i])&&angular.isDefined(n._annotation[i].save)){if(!n._annotation[i].save){delete n[i];continue}"reference"==n._annotation[i].save&&n._referenceOnly(n[i])}}else delete n[i];delete n._annotation},i.prototype._afterLoad=function(e){},i.prototype._beforeSave=function(e,t){},i.prototype._init=function(t){var n=t;this._annotation={},e.debug("Model ("+this.constructor.name+"): Original response object is:",n);for(var i in this)if(this.hasOwnProperty(i)&&!(["_afterLoad","_annotation"].indexOf(i)>-1||(angular.isObject(this[i])&&angular.isDefined(this[i].type)&&(this._annotation[i]=this[i]),angular.isUndefined(t))))if(angular.isObject(t)&&t.hasOwnProperty(i)){if(this[i]=t[i],angular.isDefined(this._annotation[i])&&"relation"==this._annotation[i].type){var r=this._annotation[i].relation;if(angular.isUndefined(r.foreignField)&&(r.foreignField=i),angular.isUndefined(n[r.foreignField]))continue;if(null===n[r.foreignField]){this[i]=null;continue}"many"==r.type&&this._mapArray(i,n[r.foreignField],r.model),"one"==r.type&&this._mapProperty(i,n[r.foreignField],r.model)}}else this[i]=null;this._afterLoad(n)},i.prototype._mapArray=function(e,n,i){var r=this;if(angular.isUndefined(n)||null===n||0===n.length)return void(r[e]=[]);if(null===i)return void angular.forEach(n,function(t){r[e].push(t)});var o=t.get(i);r[e]=[],angular.forEach(n,function(t){r[e].push(new o(t))})},i.prototype._mapProperty=function(e,n,i){if(angular.isUndefined(n))return void(this[e]=null);if(null===i)return void(this[e]=n);var r=t.get(i);this[e]=new r(n)},i.prototype._referenceOnly=function(e){if(angular.isArray(e))angular.forEach(e,function(e){e._referenceOnly(e)});else for(var t in e)e.hasOwnProperty(t)&&t!=e.reference&&delete e[t]},i.prototype.isValid=function(){var e=new n;for(var t in this)if(this.hasOwnProperty(t)&&angular.isDefined(this._annotation[t])){if(angular.isDefined(this._annotation[t].required)&&(this._annotation[t].required&&null===this[t]||this._annotation[t].required&&""===this[t]))return!1;if(!e[this._annotation[t].type](this[t])&&this._annotation[t].required)return!1}return!0},i}function s(){function e(){this._routeMatcher={}}return e.prototype._routes=function(e){this._routeMatcher={};for(var t in e)e.hasOwnProperty(t)&&(this._routeMatcher[t.match(/\[(GET|POST|PUT|DELETE|PATCH|HEAD)\]/)[1]+(t.match(/:/g)||[]).length]=e[t])},e.prototype.request=function(e,t,n){if(angular.isDefined(t)||(t=[]),angular.isDefined(this._routeMatcher[e+t.length])){var i=e+t.length;return angular.isDefined(n)&&t.push({body:n}),this._routeMatcher[i].apply(this,t)}},e}function u(){function e(){}return e.prototype.string=function(e){return angular.isString(e)},e.prototype["int"]=function(e){return angular.isNumber(e)},e.prototype.email=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},e.prototype.relation=function(e){return angular.isArray(e)||angular.isObject(e)},e.prototype["boolean"]=function(e){return angular.isDefined(e)&&null!==e&&angular.isDefined(e.constructor)?e.constructor===Boolean:!1},e.prototype.date=function(e){return angular.isDate(e)},e.prototype["float"]=function(e){return angular.isNumber(e)},e}function p(){this._endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",this.baseRoute=function(e){this.baseRoute=e},this.headResponseHeaderPrefix=function(e){this.headResponseHeaderPrefix=e},this.endpoint=function(e){var t=new o(e);return this._endpoints[e]=t,t},this.$get=["$injector",function(e){var t=this,n={};return angular.forEach(t._endpoints,function(o){angular.isFunction(o.container)&&(o.container=o.name),angular.isFunction(t.headResponseHeaderPrefix)&&delete t.headResponseHeaderPrefix,angular.isFunction(o.baseRoute)&&(o.baseRoute=t.baseRoute),o.headResponseHeaderPrefix=t.headResponseHeaderPrefix,angular.isFunction(o.mock)?n[o.name]=new i(o,e):n[o.name]=new r(o,e)}),n}],this.$get.$inject=["$injector"]}angular.module("restclient",["ngResource"]),t.prototype.get=function(){throw new Error("Not Implemented")},t.prototype.post=function(){throw new Error("Not Implemented")},t.prototype["delete"]=function(){throw new Error("Not Implemented")},t.prototype.put=function(){throw new Error("Not Implemented")},t.prototype.head=function(){throw new Error("Not Implemented")},angular.extend(n.prototype,t.prototype),n.prototype._mapResult=function(e){var t,n=this;n._log.debug("apiFactory ("+n._endpointConfig.name+"): Endpoint called");var i=n._endpointConfig.container,r=this._injector.get(n._endpointConfig.model);if(n._log.debug("apiFactory ("+n._endpointConfig.name+"): Container set to "+i),angular.isArray(e)||angular.isArray(e[i])){n._log.debug("apiFactory ("+n._endpointConfig.name+"): Result is an array");var o=angular.isArray(e)?e:e[i],a=[];angular.forEach(o,function(e){a.push(new r(e))}),t=a}else n._log.debug("apiFactory ("+n._endpointConfig.name+"): Result is NOT an array"),t=new r(e);return n._log.debug("apiFactory ("+n._endpointConfig.name+"): Mapped result is:",t),t},n.prototype._getPagination=function(e){if(angular.isDefined(e.count)&&angular.isDefined(e.limit)&&angular.isDefined(e.skip)&&e.limit>0){e.pagesArray=[];var t=e.count/e.limit;t%1!==0&&(t=Math.ceil(t));var n=parseInt(e.skip/e.limit+1),i=e.limit;e.skip+1+e.limit>e.count&&(i=1==n?e.limit:e.count-(n-1)*e.limit);var r;if(11>t)for(r=1;t>=r;r++)e.pagesArray.push(r);else if(5>=n)for(r=1;11>=r;r++)e.pagesArray.push(r);else if(n>=t-5)for(r=t-11;t>=r;r++)e.pagesArray.push(r);else for(r=n-5;n+5>=r;r++)e.pagesArray.push(r);return{count:e.count,limit:e.limit,skip:e.skip,pagesArray:e.pagesArray,pagesCount:t,currentPage:n,currentPageItemsCount:i}}return null},n.prototype.update=function(){return this.put.apply(this,arguments)},n.prototype.save=function(){return this.post.apply(this,arguments)},n.prototype.remove=function(){return this["delete"].apply(this,arguments)},angular.extend(i.prototype,n.prototype),i.prototype.get=function(t){var n=this,i=n._q.defer();return this._resource.get(t,function(r){r.result.pagination=r.pagination,r.result.endpoint=n,r.result.next=function(){return this.endpoint.get(e(t,{_skip:this.pagination.skip+this.pagination.limit,_limit:this.pagination.limit}))},r.result.previous=function(){return this.endpoint.get(e(t,{_skip:this.pagination.skip-this.pagination.limit,_limit:this.pagination.limit}))},r.result.page=function(n){return this.endpoint.get(e(t,{_skip:n*this.pagination.limit-this.pagination.limit,_limit:this.pagination.limit}))},i.resolve(r.result)},function(e){i.reject(e)}),i.promise},i.prototype.head=function(e){var t=this;t._log.debug("apiFactory ("+t._endpointConfig.name+"): (HEAD) Endpoint called");var n=this._q.defer();return this._resource.head(e,function(e,i){var r=i();if(angular.isDefined(t._endpointConfig.headResponseHeaderPrefix)&&"*"!==t._endpointConfig.headResponseHeaderPrefix)for(var o in r)0===o.toLowerCase().indexOf(t._endpointConfig.headResponseHeaderPrefix.toLowerCase())?r[o.substr(t._endpointConfig.headResponseHeaderPrefix.length,o.length)]=r[o]:delete r[o];n.resolve(r)},function(e){n.reject(e)}),n.promise},i.prototype.put=function(e,t){if(angular.isArray(t)){var n=angular.copy(t);t=[],angular.forEach(n,function(e){e.clean(),t.push(e)})}else t.clean();this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to update is:",t);var i=this._q.defer();return this._resource.update(e,t,function(e){i.resolve(e.result)},function(e){i.reject(e)}),i.promise},i.prototype.post=function(){var e,t;angular.isUndefined(arguments[1])?e=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this._q.defer();return e.clean(),this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to save is:",e),this._resource.save(t,e,function(e){n.resolve(e.result)},function(e){n.reject(e)}),n.promise},i.prototype["delete"]=function(){var t,n;angular.isUndefined(arguments[1])?t=arguments[0]:(n=arguments[0],t=arguments[1]);var i=this._q.defer(),r={id:t[t.reference]};return this._log.debug("apiFactory ("+this._endpointConfig.name+"): Model to remove is:",t),this._resource["delete"](e(r,n),function(){i.resolve()},function(e){i.reject(e)}),i.promise},angular.extend(r.prototype,n.prototype),r.prototype._extractParams=function(e){for(var t=[],n=/:(\w+)/g,i=n.exec(this._endpointConfig.route);null!==i;)t.push(i[1]),i=n.exec(this._endpointConfig.route);var r=[];return angular.forEach(t,function(t){angular.isObject(e)&&angular.isDefined(e[t])&&r.push(e[t])}),r},r.prototype.get=function(e){var t=this._q.defer(),n=new this.mock,i=n.request("GET",this._extractParams(e)),r=this._mapResult(i);return t.resolve(r),t.promise},r.prototype.post=function(){var e,t,n=new this.mock,i=this._q.defer();angular.isUndefined(arguments[1])?e=arguments[0]:(t=arguments[0],e=arguments[1]),e._method="save",e.clean();var r=n.request("POST",this._extractParams(t),e),o=this._mapResult(r);return i.resolve(o),i.promise},r.prototype.put=function(e,t){var n=new this.mock,i=this._q.defer();if(angular.isArray(t)){var r=angular.copy(t);t=[],angular.forEach(r,function(e){e._method="update",e.clean(),t.push(e)})}else t._method="update",t.clean();var o=n.request("PUT",this._extractParams(e),t),a=this._mapResult(o);return i.resolve(a),i.promise},o.prototype.route=function(e){return this.route=e,this},o.prototype.model=function(e){return this.model=e,this},o.prototype.container=function(e){return this.container=e,this},o.prototype.actions=function(e){return this.actions=e,this},o.prototype.baseRoute=function(e){return this.baseRoute=e,this},o.prototype.mock=function(e){return this.mock=e,this},angular.module("restclient").factory("Model",a),a.$inject=["$log","$injector","Validator"],angular.module("restclient").factory("Mock",s),angular.module("restclient").factory("Validator",u),angular.module("restclient").provider("api",p)}();