!function(){function n(){function n(){}function t(n,t,e,i,o,a){this.endpointName=n,this.endpointConfig=t,this.resource=i(e+this.endpointConfig.route,{},{update:{method:"PUT"}}),this.log=o,this.injector=a}this.endpoints={},this.baseRoute="",n.prototype.route=function(n){return this.route=n,this},n.prototype.model=function(n){return this.model=n,this},n.prototype.container=function(n){return this.container=n,this},t.$inject=["endpoint","endpointConfig","baseRoute","$resource","$log","$injector"],t.prototype.get=function(n){var t=this;t.log.debug("apiFactory ("+t.endpointName+"): Endpoint called");var e=t.endpointConfig.container,i=this.injector.get(t.endpointConfig.model);t.log.debug("apiFactory ("+t.endpointName+"): Container set to "+e);var o=this.resource.get(n).$promise;return o.then(function(n){if(angular.isArray(n[e])){t.log.debug("apiFactory ("+t.endpointName+"): Result is an array");var o=[];angular.forEach(n[e],function(n){o.push(new i(n))})}else{t.log.debug("apiFactory ("+t.endpointName+"): Result is NOT an array");var o=new i(n)}return t.log.debug("apiFactory ("+t.endpointName+"): Mapped result is"),t.log.debug(o),o})},t.prototype.update=function(n,t,e,i){t.__method="update",t._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to update is"),this.log.debug(t),this.resource.update(n,t,function(){e()},function(n){i(n)})},t.prototype.save=function(){var n=arguments[0],t=arguments[1],e=arguments[2],i=arguments[3];angular.isUndefined(arguments[3])&&(t=arguments[0],e=arguments[1],i=arguments[2]),t.__method="save",t._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to save is"),this.log.debug(t),this.resource.save(n,t,function(){e()},function(n){i(n)})},this.baseRoute=function(n){this.baseRoute=n},this.endpoint=function(t){var e=new n;return this.endpoints[t]=e,e},this.$get=["$injector",function(n){var e=this,i={};return angular.forEach(e.endpoints,function(o,a){angular.isFunction(o.container)&&(o.container=a),i[a]=n.instantiate(t,{endpoint:a,endpointConfig:o,baseRoute:e.baseRoute})}),i}]}function t(n,t,e){function i(){this.__foreignData={},this.__annotation={}}return i.prototype.afterLoad=function(){return!0},i.prototype.beforeSave=function(){return!0},i.prototype.init=function(t){this.__foreignData=t,this.__annotation={},n.debug("Model ("+this.constructor.name+"): Original response object is"),n.debug(this.__foreignData);for(var e in this)if(this.hasOwnProperty(e)&&!(["__foreignData","__annotation"].indexOf(e)>-1)&&(angular.isObject(this[e])&&angular.isDefined(this[e].type)&&(this.__annotation[e]=this[e]),!angular.isUndefined(t)))if(angular.isObject(t)&&t.hasOwnProperty(e)){if(this[e]=t[e],angular.isDefined(this.__annotation[e])&&"relation"==this.__annotation[e].type){var i=this.__annotation[e].relation;if(angular.isUndefined(i.foreignField)&&(i.foreignField=e),angular.isUndefined(this.__foreignData[i.foreignField]))continue;if(null===this.__foreignData[i.foreignField]){this[e]=null;continue}"many"==i.type&&this._mapArray(e,this.__foreignData[i.foreignField],i.model),"one"==i.type&&this._mapProperty(e,this.__foreignData[i.foreignField],i.model)}}else this[e]=null;this.afterLoad(),delete this.__foreignData},i.prototype.callBeforeSave=function(n){angular.isArray(n)&&angular.forEach(n,function(n){n._clean()}),angular.isObject(n)&&!angular.isArray(n)&&n._clean()},i.prototype.__reference="id",i.prototype._clean=function(){this.beforeSave();for(var n in this)if(this.hasOwnProperty(n)){if(angular.isDefined(this.__annotation[n])&&angular.isDefined(this.__annotation[n].save)){if(!this.__annotation[n].save){delete this[n];continue}if("reference"==this.__annotation[n].save){this._referenceOnly(this[n]);continue}}if(angular.isDefined(this.__annotation[n])&&angular.isDefined(this.__annotation[n].type)&&"relation"==this.__annotation[n].type&&null!==this[n]){if(!angular.isDefined(this.__annotation[n].relation.type))continue;if("one"==this.__annotation[n].relation.type){this[n]._clean();continue}"many"==this.__annotation[n].relation.type&&angular.forEach(this[n],function(n){n._clean()})}}delete this.__method,delete this.__annotation},i.prototype._mapArray=function(n,e,i){var o=this;if(angular.isUndefined(e)||null==e||0==e.length)return void(o[n]=[]);var a=t.get(i);o[n]=[],angular.forEach(e,function(t){o[n].push(new a(t))})},i.prototype._mapProperty=function(n,e,i){if(angular.isUndefined(e))return void(this[n]=null);var o=t.get(i);this[n]=new o(e)},i.prototype._referenceOnly=function(n){if(angular.isArray(n))angular.forEach(n,function(n){n._referenceOnly(n)});else for(var t in n)n.hasOwnProperty(t)&&t!=n.__reference&&delete n[t]},i.prototype.isValid=function(){for(var n in this)if(this.hasOwnProperty(n)&&angular.isDefined(this.__annotation[n])&&!e[this.__annotation[n].type](this[n]))return!1;return!0},i}function e(){return{string:function(n){return angular.isString(n)},"int":function(n){return angular.isNumber(n)},email:function(n){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(n)},relation:function(){return!0},"boolean":function(){return!0},date:function(n){return angular.isDate(n)},"float":function(n){return angular.isNumber(n)}}}angular.module("restclient",[]).provider("api",n).factory("Model",t).factory("Validator",e),t.$inject=["$log","$injector","Validator"]}();