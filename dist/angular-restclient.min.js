!function(){"use strict";function e(e,t){if(!angular.isDefined(e)&&!angular.isDefined(t))return{};if(!angular.isDefined(e))return t;if(!angular.isDefined(t))return e;if(angular.isDefined(angular.merge))return angular.merge(e,t);var n=e.$$hashKey;if(angular.isObject(t)||angular.isFunction(t)){for(var i=Object.keys(t),r=0,a=i.length;a>r;r++){var o=i[r],s=t[o];angular.isObject(s)?(angular.isObject(e[o])||(e[o]=angular.isArray(s)?[]:{}),this(e[o],s)):e[o]=s}return n?e.$$hashKey=n:delete e.$$hashKey,e}}function t(t,n,i,r,a){var o=this;angular.isFunction(n.baseRoute)||(i=n.baseRoute),this.endpointName=t,this.headResponseHeaderPrefix=r,this.endpointConfig=n,this.resource=a.get("$resource")(i+this.endpointConfig.route,{},e({get:{method:"GET",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:o.mapResult(angular.fromJson(e)),pagination:o.getPagination(e)}}},save:{method:"POST",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:o.mapResult(e)}}},update:{method:"PUT",transformResponse:function(e,t,n){return e=angular.fromJson(e),n>=400?e:{result:o.mapResult(e)}}},head:{method:"HEAD"},remove:{method:"DELETE"}},n.actions)),this.log=a.get("$log"),this.injector=a,this.q=a.get("$q")}function n(){}function i(e,t,n){function i(){this.__foreignData={},this.__annotation={}}return i.prototype.afterLoad=function(){return!0},i.prototype.beforeSave=function(){return!0},i.prototype.init=function(t){this.__foreignData=t,this.__annotation={},e.debug("Model ("+this.constructor.name+"): Original response object is:",this.__foreignData);for(var n in this)if(this.hasOwnProperty(n)&&!(["__foreignData","__annotation"].indexOf(n)>-1||(angular.isObject(this[n])&&angular.isDefined(this[n].type)&&(this.__annotation[n]=this[n]),angular.isUndefined(t))))if(angular.isObject(t)&&t.hasOwnProperty(n)){if(this[n]=t[n],angular.isDefined(this.__annotation[n])&&"relation"==this.__annotation[n].type){var i=this.__annotation[n].relation;if(angular.isUndefined(i.foreignField)&&(i.foreignField=n),angular.isUndefined(this.__foreignData[i.foreignField]))continue;if(null===this.__foreignData[i.foreignField]){this[n]=null;continue}"many"==i.type&&this._mapArray(n,this.__foreignData[i.foreignField],i.model),"one"==i.type&&this._mapProperty(n,this.__foreignData[i.foreignField],i.model)}}else this[n]=null;this.afterLoad(),delete this.__foreignData},i.prototype.callBeforeSave=function(e){angular.isArray(e)&&angular.forEach(e,function(e){e._clean()}),angular.isObject(e)&&!angular.isArray(e)&&e._clean()},i.prototype.__reference="id",i.prototype._clean=function(){this.beforeSave();for(var e in this)if(this.hasOwnProperty(e))if(null!==this[e]){if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].save)){if(!this.__annotation[e].save){delete this[e];continue}if("reference"==this.__annotation[e].save){this._referenceOnly(this[e]);continue}}if(angular.isDefined(this.__annotation[e])&&angular.isDefined(this.__annotation[e].type)&&"relation"==this.__annotation[e].type&&null!==this[e]){if(!angular.isDefined(this.__annotation[e].relation.type))continue;if("one"==this.__annotation[e].relation.type){this[e]._clean();continue}"many"==this.__annotation[e].relation.type&&angular.forEach(this[e],function(e){e._clean()})}}else delete this[e];delete this.__method,delete this.__annotation},i.prototype._mapArray=function(e,n,i){var r=this;if(angular.isUndefined(n)||null===n||0===n.length)return void(r[e]=[]);if(null===i)return void angular.forEach(n,function(t){r[e].push(t)});var a=t.get(i);r[e]=[],angular.forEach(n,function(t){r[e].push(new a(t))})},i.prototype._mapProperty=function(e,n,i){if(angular.isUndefined(n))return void(this[e]=null);if(null===i)return void(this[e]=n);var r=t.get(i);this[e]=new r(n)},i.prototype._referenceOnly=function(e){if(angular.isArray(e))angular.forEach(e,function(e){e._referenceOnly(e)});else for(var t in e)e.hasOwnProperty(t)&&t!=e.__reference&&delete e[t]},i.prototype.isValid=function(){for(var e in this)if(this.hasOwnProperty(e)&&angular.isDefined(this.__annotation[e])){if(angular.isDefined(this.__annotation[e].required)&&(this.__annotation[e].required&&null===this[e]||this.__annotation[e].required&&""===this[e]))return!1;if(!n[this.__annotation[e].type](this[e])&&this.__annotation[e].required)return!1}return!0},i}function r(){return{string:function(e){return angular.isString(e)},"int":function(e){return angular.isNumber(e)},email:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},relation:function(e){return!0},"boolean":function(e){return!0},date:function(e){return angular.isDate(e)},"float":function(e){return angular.isNumber(e)}}}function a(){this.endpoints={},this.baseRoute="",this.headResponseHeaderPrefix="",this.baseRoute=function(e){this.baseRoute=e},this.headResponseHeaderPrefix=function(e){this.headResponseHeaderPrefix=e},this.endpoint=function(e){var t=new n;return this.endpoints[e]=t,t},this.$get=["$injector",function(e){var n=this,i={};return angular.forEach(n.endpoints,function(r,a){angular.isFunction(r.container)&&(r.container=a),angular.isFunction(n.headResponseHeaderPrefix)&&delete n.headResponseHeaderPrefix,i[a]=new t(a,r,n.baseRoute,n.headResponseHeaderPrefix,e)}),i}],this.$get.$inject=["$injector"]}t.prototype.getPagination=function(e){if(angular.isDefined(e.count)&&angular.isDefined(e.limit)&&angular.isDefined(e.skip)&&e.limit>0){e.pagesArray=[];var t=e.count/e.limit;t%1!==0&&(t=Math.ceil(t));var n=parseInt(e.skip/e.limit+1),i=e.limit;e.skip+1+e.limit>e.count&&(i=1==n?e.limit:e.count-(n-1)*e.limit);var r;if(5>=n)for(r=1;11>=r;r++)e.pagesArray.push(r);else if(n>=t-5)for(r=t-11;t>=r;r++)e.pagesArray.push(r);else for(r=n-5;n+5>=r;r++)e.pagesArray.push(r);return{count:e.count,limit:e.limit,skip:e.skip,pagesArray:e.pagesArray,pagesCount:t,currentPage:n,currentPageItemsCount:i}}return null},t.prototype.mapResult=function(e){var t,n=this;n.log.debug("apiFactory ("+n.endpointName+"): Endpoint called");var i=n.endpointConfig.container,r=this.injector.get(n.endpointConfig.model);if(n.log.debug("apiFactory ("+n.endpointName+"): Container set to "+i),angular.isArray(e)||angular.isArray(e[i])){n.log.debug("apiFactory ("+n.endpointName+"): Result is an array");var a=angular.isArray(e)?e:e[i],o=[];angular.forEach(a,function(e){o.push(new r(e))}),t=o}else n.log.debug("apiFactory ("+n.endpointName+"): Result is NOT an array"),t=new r(e);return n.log.debug("apiFactory ("+n.endpointName+"): Mapped result is:",t),t},t.prototype.get=function(t){var n=this,i=n.q.defer();return this.resource.get(t,function(r){r.result.pagination=r.pagination,r.result.endpoint=n,r.result.next=function(){return this.endpoint.get(e(t,{_skip:this.pagination.skip+this.pagination.limit,_limit:this.pagination.limit}))},r.result.previous=function(){return this.endpoint.get(e(t,{_skip:this.pagination.skip-this.pagination.limit,_limit:this.pagination.limit}))},r.result.page=function(n){return this.endpoint.get(e(t,{_skip:n*this.pagination.limit-this.pagination.limit,_limit:this.pagination.limit}))},i.resolve(r.result)},function(e){i.reject(e)}),i.promise},t.prototype.head=function(e){var t=this;t.log.debug("apiFactory ("+t.endpointName+"): (HEAD) Endpoint called");var n=this.q.defer();return this.resource.head(e,function(e,i){var r=i();if(angular.isDefined(t.headResponseHeaderPrefix)&&"*"!==t.headResponseHeaderPrefix)for(var a in r)0===a.toLowerCase().indexOf(t.headResponseHeaderPrefix.toLowerCase())?r[a.substr(t.headResponseHeaderPrefix.length,a.length)]=r[a]:delete r[a];n.resolve(r)},function(e){n.reject(e)}),n.promise},t.prototype.update=function(e,t){if(angular.isArray(t)){var n=angular.copy(t);t=[],angular.forEach(n,function(e){e.__method="update",e._clean(),t.push(e)})}else t.__method="update",t._clean();this.log.debug("apiFactory ("+this.endpointName+"): Model to update is:",t);var i=this.q.defer();return this.resource.update(e,t,function(e){i.resolve(e.result)},function(e){i.reject(e)}),i.promise},t.prototype.put=t.prototype.update,t.prototype.save=function(){var e,t;angular.isUndefined(arguments[1])?e=arguments[0]:(t=arguments[0],e=arguments[1]);var n=this.q.defer();return e.__method="save",e._clean(),this.log.debug("apiFactory ("+this.endpointName+"): Model to save is:",e),this.resource.save(t,e,function(e){n.resolve(e.result)},function(e){n.reject(e)}),n.promise},t.prototype.post=t.prototype.save,t.prototype.remove=function(){var t,n;angular.isUndefined(arguments[1])?t=arguments[0]:(n=arguments[0],t=arguments[1]);var i=this.q.defer();t.__method="remove";var r={id:t[t.__reference]};return this.log.debug("apiFactory ("+this.endpointName+"): Model to remove is:",t),this.resource["delete"](e(r,n),function(){i.resolve()},function(e){i.reject(e)}),i.promise},t.prototype["delete"]=t.prototype.remove,n.prototype.route=function(e){return this.route=e,this},n.prototype.model=function(e){return this.model=e,this},n.prototype.container=function(e){return this.container=e,this},n.prototype.actions=function(e){return this.actions=e,this},n.prototype.baseRoute=function(e){return this.baseRoute=e,this},angular.module("restclient",["ngResource"]),angular.module("restclient").factory("Model",i),i.$inject=["$log","$injector","Validator"],angular.module("restclient").factory("Validator",r),angular.module("restclient").provider("api",a)}();